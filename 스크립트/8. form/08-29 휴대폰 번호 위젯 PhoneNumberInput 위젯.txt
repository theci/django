이번에는 휴대폰 번호를 단일 위젯이 아닌 세 부분, 국번, 중간번호, 마지막 번호로
나누어 입력받는 PhoneNumberInput 위젯을 구현해 보겠습니다.
이 방법은 주소, 주민번호 등에 입력 시에도 활용할 수 있습니다.
한 위젯 내에서 여러 서브 위젯을 사용하기 위해 멀티 위젯 클래스를 상속받아
PhoneNumberInput 위젯 클래스를 정의합니다.
멀티 위젯은 여러 위젯을 그룹화하여 사용할 때 기반이 되는 클래스입니다.
멀티 위젯 클래스는 생성자로 내부에서 사용할 하위 위젯 인스턴스 리스트를 받습니다.
텍스트 인풋 위젯 인스턴스를 생성하고요.
3개의 텍스트 인풋 위젯 인스턴스 모두에게 동일하게 Attributes를 지정하여 위젯의
가로 크기와 오른쪽 마진도 지정하고요.
웹브라우저 단에서 자동완성 기능도 꺼줍니다.
웹브라우저에서 인풋 타입 텍스트 요소에서는 웹브라우저 유효성 검사 시에 패턴 인자와 맥스
랭스 인자를 지원하는데요.
맥스 랭스 길이만큼 입력을 허용하고 패턴 정규 표현식에 맞지 않을 경우 유효성 검사 오류를
발생시킵니다.
웹브라우저 유효성 검사를 사용하지 않을 경우 사용되지 않는 속성이지만 별도 자바스크립트
코드로 클라이언트 딴 유효성 검사를 구현하실 경우 패턴 속성을 활용해 보실 수도 있습니다
폰넘버 위젯에 전달된 문자의 값을 하위 위젯으로 값을 전달해 줘야 할 텐데요
이 역할을 decompress 메서드에서 수행합니다 전달된 값이 있다면, 하이픈 9문자를
문자에를 제거하고, 순서대로 3자리, 4자리, 4자리 문자를 추출하여 튜플로 반환하면 각
위젯에 반영됩니다.
반대로, 각 하위 위젯의 값들을 하나로 합칠 때에는 ValueFromDataDict
메서드가 호출됩니다.
부모의 메서드를 오버라이드하여 문자열 리스트를 받아서 하나의 문자열로 합쳐 반환하도록 했습니다.
이렇게 폰 넘버 인풋 위젯 클래스를 구현할 수 있고요.
위젯은 입력 UI만을 구성할 뿐, 유효성 검사에 책임이 없습니다.
서버 딴 유효성 검사 로직은 폰 필드나 모델 필드에서 구현하시게 됩니다.
폰 넘버 필드 폰 필드를, 캐릭터 필드 폰 필드를 상속받아 구현하고요.
기본 위젯으로 폰 넘버 인풋 위젯을 지정합니다.
기본 유효성 검사 함수로 휴대폰 번호 패턴에 정규 표현식(Regex) 유효성 검사기를 지정하고요.
유효성 검사에 실패하면 인벨리드 키의 에러 메세지를 낼 텐데, default error
messages 사전으로 유효하지 않은 키에 대한 에러 메세지도 등록합니다.
입력된 휴대폰 번호 문자열에서 하이픈이 있는 상황도 허용한다면, 최대 길이 13으로
지정합니다.
Accounts의 프로필 모델에 폰 번호 필드는 CharacterField 타입으로
추가하고, 단일 필드로 모델 폼에 추가를 먼저 해보겠습니다.
마이그레이션(Migrations) 과정을 수행하고요.
프로필 폼, 모델 폼에 폰 넘버 필드를 추가하면 프로필 수정 폼에서 이렇게 휴대폰 번호를
입력할 수 있는 필드가 뜹니다
그런데 휴대폰 번호 필드에 휴대폰 번호 포맷이 아닌 아무 문자열이나 입력에도 저장이 되죠
폰 넘버, 모델 필드에 정규 표현식(Regex) 유효성 검사기로 휴대폰 번호 패턴을 추가해서 휴대폰 번호
패턴에 대한 유효성 검사를 수행하도록 했습니다
이제 휴대폰 번호를 3개 입력 필드로 나눠서 입력을 받아 보겠습니다
멀티 위젯 클래스를 상속받은 폰넘버 인풋 위젯 클래스를 정의합니다
생성자는 다른 위젯 클래스처럼 attributes 인자만 받을 텐데요
부모인 MultiWidget 클래스의 생성자를 보면 Widgets 인자를 추가로 받습니다.
HighWidgetInstance의 리스트를 인자로 받고요.
사전 타입으로도 지정할 수 있네요.
생성자에서 TextInputWidget를 3개 생성하고 리스트로 부모
생성자로 넘겨주겠습니다.
프로필 폼, 모델 폼에서 폰넘버 필드의 위젯을 폰넘버 인풋 Widget으로 변경해
볼게요. 프로필 수정 폼을 띄워보시면 이렇게 휴대폰 번호를 받는 위치에 위젯 3개가 렌더링
됩니다 각 입력 요소들은 숫자를 3자에서 4자만 입력 받을 텐데 가로 크기가 너무 크죠?
Attribute 인자로 CSS 설정을 해주고 블라우저 자동완성 기능도 꺼줄게요
새로고침하면 첫 번째 요소의 가로 크기가 줄고 자동완성 끄기 속성도 지정되었습니다
다른 위젯에도 적용해줘야 하니까 이 사전을 클래스 변수로 빼주고요 추가 속성으로 패턴과
맥스 렝스도 지정합니다
브라우저를 새로고침해 보면 지정한 속성으로 잘 렌더링이 되고 있네요.
그런데 max-length 값이 각 위젯에 지정한 대로 3과 4로 나오지 않고 일괄적으로
13으로 나옵니다.
이 13이라는 값은 프로필 모델에서 PhoneNumber 모델 필드의 max-length 값이
13이었죠.
MultiWidget 클래스의 GetContextData 메서드를 분석해 보면
BuildAttribute 메서드에서 생성된 Attribute 사전 값이 하위
Widget들의 Attribute 값에 덮어쓰기가 되고 있습니다.
BuildAttribute 메서드를 재정의해서 생성되는 Attribute 값을 확인해 보면
이렇게 MaxLength 값이 13으로 찍혀있죠.
Attribute 사전에 MaxLength 키가 있다면 제거하여 HighWidth의
Attribute 값을 덮어 쓰지 않도록 해줍니다.
그럼 이렇게 각 위젯에 지정한 대로 맥스랭스 값이 잘 출력되고 있습니다.
멀티 위젯을 통해 여러 위젯으로 나누어 값을 입력받지만 실제 하나의 값을 처리하는 것이죠.
decompress 메서드를 통해 하나의 값을 변환하여 각 하위 위젯의 초기 값을
준비하고요.
valueFromDataDict 메서드를 통해 하위 위젯들로부터 전달받은 값을 합쳐 하나의
값으로 다시 역변환합니다.
디컴프레스 메서드에서는 공백과 하이픈이 있다면 제거하고, 문자열 순서대로 세 글자, 네
글자, 네 글자씩 슬라이싱하여 투플로 반환합니다.
valueFromDataDict 메서드에서는 문자열 리스트를 하나의 문자열로 합친 문자열을 반환하고요.
반환된 값으로 유효성 검사를 수행하게 됩니다.
그런데 값에 따라 리스트의 문자열이 아닌 논 값으로 채워질 수도 있습니다.
조인 처리 시에 문자열이 아닌 값이 있으면 타입으로 예배가 발생합니다.
리스트 컴포넨션 문법으로 각 값을 순회 돌면서 값이 거짓이면 대체 값으로 빈 문자열로
리스트를 구성하도록 하여 조인 처리합니다.
논 값은 거짓 판정을 받습니다.
대신를 빼고 제너라이터 표현식으로 쓰셔도 됩니다.
휴대폰 번호가 아닌 문자열을 입력하면 이렇게 유효성 검사 오류가 발생합니다.
프로필 모델의 폰넘버 필드에 지정한 정규 표현식의 메세지 인자로 유효성 검사 오류
시에 커스텀 오류 메시지를 등록하실 수 있습니다.
모델 폼이 아닌 폼 클래스에서 사용할 수 있는 폰넘버 필드 폼 필드를 만들어 보겠습니다
CharField 폼 필드를 상속 받고요 디폴트 에러 메시지를 재정의할 수 있는 디폴트 에러
메세지스 사전을 정의하고 디폴트 위젯으로 폰넘버 인풋 위젯을 지정합니다
디폴트 유효성 검사 함수로는 정규 표현식 검증기를 활용해서 휴대폰 번호 정규 표현식을
지정하고요.
생성자를 재정의해서 캐릭터 필드 폼필드에서 지원하는 인자 중에 MaxLength와
MinLength에 대해서 디폴트 값을 13과 11로 각각 지정합니다.
그럼 최소 길이, 최대 길이에 대한 유효성 검사 함수가 자동으로 등록이 돼요.
테스트로 폰넘버 폼필드를 추가해 보겠습니다.
모델 폼에 추가했으니 모델로부터 자동 추가된 PhoneNumber 필드는 덮어쓰기 된 거예요
PhoneNumber 필드, 폼필드를 통해 유효성 검사가 잘 수행되고요 default error
messages의 invalid 코드로 custom 유효성 검사 오류 메시지를 등록하시면
해당 메시지로 잘 표시됩니다
지금 테스트로 추가한 PhoneNumber 폼필드는 모델과 연결된 필드가 아니기에 초기값 지정 및
save 저장을 위해서 별도 코드가 필요합니다
PhoneNumber와 폰필드를 제거하고 다시 모델로부터 자동 생성된 설정을 살리겠습니다.