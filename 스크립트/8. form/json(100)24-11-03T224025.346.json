입력된 글자 수를 보여주는 텍스트 인풋 위젯을 만들어 볼 텐데요 기본 기능이 있는 위젯
클래스를 상속받아 그 위젯의 템플릿에 HTML과 JavaScript를 통해 기능을 추가하고
해당 템플릿을 위젯 클래스의 템플릿 네임 설정에 적용하는 방식으로 구현하겠습니다
텍스트 인풋 위젯은 장고, 폼즈, 위젯스의의 Input.html 템플릿을 사용합니다
커스텀 템플릿 파일을 만들고 텍스트 인풋 위젯의 기본 템플릿을 인클로드합니다
그리고 이어서 HTML과 JavaScript를 추가합니다 글자 수를 노출할 div를 하나
추가하고요 스크립트 태그의 자바스크립트 코드는 전역 범위를 오염시키지 않도록 함수를
만들어서 즉시 호출하여 수행하도록 했습니다
웹브라우저는 HTML 문자열을 DOM Tree로 변환하여 웹 문서를 구성하는데요
자바스크립트에서는 DOM Tree의 각 요소들을 찾기 위해 ID나 클래스 속성을 사용합니다
위젯의 특성상 한 페이지 내에서 같은 위젯이 여럿 반복될 수도 있기에 아이디나 클래스
속성을 활용한 DOM 요소 조회는 조심하지 않으면 엉뚱한 DOM을 조회할 수도 있습니다.
그래서 아이디나 클래스 속성 없이
document.currentScript.previousElementSibling을 통해 스크립트
태그의 직전 요소를 참조하도록 해서 스크립트 태그 직전 요소인 div 요소가 있고 div
요소의 직전 요소인 input 요소를 이렇게 DOM으로 조회합니다
apply 함수가 호출되면 위젯 DOM에 저장된 문자에 대한 글자 수를 label DOM에
표현하도록 하고요 위젯 DOM의 inputEventListener로서 apply 함수를
등록하면 입력 값의 변화가 있을 때마다 자동으로 글자 수가 아래에 보여질 것입니다 이벤트
리스너 등록 후에 Apply 함수를 호출하여 초기 글자 수도 보여주도록 했습니다.
위젯을 만들어서 웹 로그 앱의 포스팅 폼 뷰에 적용해 보겠습니다 슬라이드 하단에 소스코드
링크가 있고요 코어 폼즈의 위젯 스파이 파일 경로에 위젯 클래스를 복사해 주세요
한 줄 텍스트 입력을 받는 텍스트 입력 클래스를 상속받아 템플릿 설정만 변경해 주겠습니다
템플릿 경로에 맞춰 CounterText.html 템플릿도 생성해 줍니다
템플릿 코드는 include 코드만 복사하시고 나머진 직접 입력해 보겠습니다
글자 수가 보여지 div 태그를 하나 추가하고요 글자 크기는 조금 작게 보여지기 위해
0.5em을 지정했습니다
이어서 script 태그로 생성하고요 아래 script 구현에서 input 요소, div
요소, script 요소의 순서가 중요하니 순서를 꼭 지켜주세요
익명 함수를 하나 만들고 즉시 호출토록 하고 내부 구현을 시작합니다
콘솔 로그로 CounterTextInput 위젯이라고 출력만 해보겠습니다
이 코드가 수행되면 브라우저 개발자 도구의 콘솔 창에 이 메시지가 뜰 거예요
웹 로그 앱의 PostForm, ModelForm 클래스에서 Title 필드의 위젯만
CounterTextInput으로 변경합니다
브라우저 개발자 도구 여시고 콘솔 탭 열어주시고요
새로고침하시면 이렇게 메시지가 나오죠
위젯이 정상 등록되어 동작하고 있습니다
현 스크립트 요소의 직전 형제 요소를 labelDom에 저장하고요 labelDom의 직전
형제 요소를 widgetDom에 저장합니다
apply 함수를 정의하고요 apply 함수가 호출되면 labelDom의 innerHTML
속성으로 내부HTML을 변경할 텐데 그 HTML 문자열은 widgetDomText 입력
요소의 text 문자열의 길이를 문자열로 변환하고 글자 문자열을 붙인 문자열입니다
apply 함수가 호출될 때마다 한 글자, 두 글자, 세 글자라고 갱신이 될 겁니다
이 Apply 함수가 입력 값의 변화에 맞춰 자동 호출이 되도록 위젯돔의 Input
이벤트에 대한 이벤트 리스너로서 Apply 함수를 등록합니다.
그리고 처음 페이지가 보여질 때에는 아직 Input 이벤트가 발생하기 전이죠.
그러니 Apply 함수를 직접 호출하여 처음의 글자 수를 한번 보여주겠습니다.
포스팅 폼을 새로 고침하면 0글자라고 보여지네요.
텍스트를 입력하시면 그에 맞춰 글자 수가 맞게 보여짐을 확인하실 수 있습니다.
Apply 함수를 변경하여 글자수가 0일 때에는 글자수를 보여주지 않고 1 이상일 때에만
글자수를 보여주도록 개선해 보셔도 좋겠습니다
CounterTextInput 위젓은 유저에게 부가적인 UI 정보를 보여줄 뿐 폼이 서버로
전송하는 데이터에는 영향을 끼치지 않습니다