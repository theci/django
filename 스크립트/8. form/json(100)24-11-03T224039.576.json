ImageField 폰필드에서 업로드할 이미지를 선택하면 이미지 파일명만 보여지는데요
선택한 이미지까지 프리뷰로 보여주는 이미지 업로더 위젯을 만들어 보겠습니다
파일필드 ImageField 폰필드의 디폴트 위젯은 ClearableFileInput 위젯이고요
이 위젯을 상속받아서 PreviewClearableFileInput 위젯 클래스를
정의합니다
ClearableFileInput 위젯의 템플릿 파일에 HTML과 JavaScript를
추가한 템플릿을 구현하고요 그 템플릿의 경로를 지정하는 것으로 위젯을 만들어 보겠습니다
이미지를 보여줄 태그를 추가하고요 이미지는 작게 보여주기 위해 가로 최대 크기 100px,
투명도는 80%, 기본으로 숨기겠습니다
이미지 주소인 src 속성은 빈 문자열로 지정합니다 아래에서 자바스크립트를 통해 지정할
것이고요 스크립트 내에서는 이미지 요소와 인풋 타입 파일 요소를 조회하고요 인풋 타입 파일
요소에 변화가 있을 때 선택된 파일 리스트에서 첫 번째 파일을 인자로 넘겨 메모리에 저장된
데이터에 대한 URL 문자열을 획득하실 수 있습니다
이 URL을 이미지 요소의 src 속성에 지정하고요 이미지 요소의 스타일 속성에서
디스플레이 속성을 제거하여 이미지가 보여지도록 합니다
웹 로그 앱의 포스팅 폼에서 포토 필드에 대해 이미지 파일을 선택해 보면 이렇게 파일명만
보여지고 있습니다
파일명 뿐만 아니라 이미지까지 프리뷰로 보여지도록 위젯을 만들어 보겠습니다
기존 파일 위젯인 ClearableFileInput 클래스를 상속받아서 새로운 위젯
클래스를 정의합니다
이전에 관련 템플릿을 일부 생성했었고요 템플릿 파일을 수정해서 위젯 구현을 마무리하겠습니다
프리뷰 이미지를 보여줄 태그를 추가하고요 이미지의 기본 스타일도 적용합니다 이미지가 없을
때 보여줄 대체 텍스트도 지정했습니다
이 대체 텍스트가 보여질 경우는 없을 듯 한데요 PyCharm에서는 태그에 Alt 속성이 없을
경우 경고를 띄우기에 추가해줬습니다
src 속성은 빈 문자에를 지정했고요 이미지 태그에는 src 속성을 지정하지 않으셔도
되지만 아래에서 src 속성을 사용할 테니 이미지 태그에서 src 속성을 활용한다는 의도로
추가해 봤습니다
자바스크립트에서 이전 이미지 요소를 조회하고 인풋 타입 파일 요소도 조회합니다 인풋 타입
파일 요소의 변화가 있을 때 선택된 파일 리스트에서 첫 번째 파일에 대해 url을 생성해서
src 속성에 지정합니다
그럼 디스플레이 논 스타일이 있죠?
이를 제거하여 이미지가 보여지도록 합니다
웹 로그의 포스트폼 모델 폼에서 포토필드에 대해 위젯을 지정하시고요
페이지 새로 고치 마시고 포토필드에서 이미지 파일을 선택하시면 이렇게 프리뷰 이미지가
보여짐을 확인하실 수 있습니다
브라우저 개발자 로그 열어보시면 선택된 JavaScript 파이 객체도 확인하실 수 있습니다