안녕하세요. 이번 시간에는 장고 에러 로고와 관리자 이메일 발송에 대해서
살펴보겠습니다.
HTTP 요청 처리 시에 에러가 발생한다면 세팅스의 디버그 설정이 참일 때에는 이처럼
디버깅 화면을 통해 오류를 확인할 수 있는데요.
디버그 설정이 거짓일 때에는 세부 디버깅 정보를 알 수 없습니다.
게다가 이마저도 유저만이 에러 발생 여부를 알 수 있고 관리자는 알 수가 없죠.
장고 인스턴스 서버에 고의로 에러 상황을 만들어 보겠습니다.
디버그 환경 변수를 소문자 False로 지정하시면 디버그 설정이 거짓으로 설정됩니다.
데이터베이스 URL 환경 변수를 고의로 틀리게 지정해 보겠습니다.
환경 변수 반영을 위해 장고 서비스를 재시작합니다.
웹페이지 새로고침하면 오백 에러가 떴습니다.
서버에서 서버 로그를 확인해 보실 수도 있지만 이마저도 settings의 디버그 설정이 참인
상황에서만 기록됩니다.
장고 서비스에 대한 로그를 조회해 봅니다.
세팅스의 디버그 설정이 거짓이니 에러 로그가 없습니다.
디버그 설정이 참으로 반영되도록 디버그 환경 변수를 제거하고 장고 서비스 재시작하고요.
로그를 열어두겠습니다.
웹페이지 새로고침하면 디버그 설정이 참인 상황이니 웹페이지에도 에러 디버깅 화면이
보여지고 로그에도 에러 로고가 즉시 출력됩니다.
다시 디버그 설정을 거짓으로 변경해 주세요.
장고 기본 로깅 설정에 매일 어드밴스 설정이 있습니다.
settings의 디버그 값이 거짓인 상황에서만 동작하고요.
어드빈 메일 핸들러를 통해서 처리됩니다.
세팅스의 디버그 설정이 거짓인 상황에서 에러가 발생할 때마다 세팅스의 어드민스 리스트에
지정된 주소로 오류 내역이 담긴 이메일을 보냅니다.
메일 발송에서 이메일 주소만 사용되며 이름은 사용되지 않습니다.
이메일 송신자 주소는 서버_이메일 설정을 따릅니다.
SMTP 설정으로 네이버 메일을 지정하셨다면 서버 이메일 설정도 네이버 메일 주소로 지정해
주셔야 메일 발송이 될 것입니다.
admins 설정은 에러 이메일 발송 외에도 send test 이메일 관리 명령에서
admins 옵션을 지정하면 admins 리스트에 지정된 이메일 주소로 테스트 이메일을
보냅니다.
admins 설정과 서버 이메일 설정을 환경 변수를 통해 주입받아 보겠습니다.
Django Invite 라이브러리에서는 admins의 이중 리스트 포맷을 직접적으로
지원하지 않습니다.
settings 파일은 설정 파일이지만 파이썬 코드이기에 다양한 파이썬 모듈을 활용할 수
있는데요. Django Environ 공식 문서에서 팁으로 소개된 코드입니다.
파이썬 기본 라이브러리의 email, utils, getaddresses 함수를 통해서
이름, 주소, 리스트 포맷에 문자열을 한 번에 이중 리스트 포맷으로 변환하실 수 있습니다.
admins 환경 변수 값이 없다면 빈 리스트로 지정됩니다.
서버 이메일 설정 값은 default로 default-from 이메일 설정 값을 사용하도록
하겠습니다. 로컬의 개발 환경을 엽니다.
테스트 환경 변수로써 admins 환경 변수에는 보통의 이메일에서처럼 이름, 꺽쇠,
이메일, 주소 포맷이고요.
여러 주소는 콤마를 구분자로 해서 지정합니다.
이름과 꺽쇠 없이 이메일 주소만 지정하면 이름은 빈 문자열로 지정됩니다.
세팅스에서는 어드민스 환경 변수 값을 리스트가 아닌 문자열 포맷으로 읽어내고요.
이메일, 유틸즈의 getAddresses 함수에 반드시 리스트 포맷으로 인자를 전달합니다.
그리고 서버 이메일 설정은 디폴트 값으로 defaultFromEmail 설정을 사용하도록
합니다.
Django Share에서 열어서 세팅스 반영을 확인해 보겠습니다.
강의의 소스코드 저장소를 복제하신 분들은 이미 세팅스에 반영되어 있고요.
각자의 저장소를 사용하시는 분들은 Git 풀 명령으로 추가된 커밋을 반영해 주세요.
django.env 환경 변수 파일에 여러분들의 이메일 주소로 어드민스 환경 변수를 추가해
주시고요. Django 서비스 재시작합니다.
웹페이지 새로고침하시면 응답 화면은 그대로이고요.
Admin List에 지정된 주소로 이메일이 발송되었을 것입니다.
잠시 후에 이렇게 에러 내역이 담긴 이메일을 수신했습니다.