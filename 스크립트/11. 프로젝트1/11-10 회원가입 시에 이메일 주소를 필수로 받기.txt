회원가입 후에 환영 이메일 발송을 하려면 유저의 이메일 주소가 필요합니다.
회원가입 과정에서 이메일 주소를 필수 필드로 받아보겠습니다.
여기에서는 하나의 폼으로 입력을 받을 텐데요.
회원가입 과정에서 입력받을 필드가 많다면 Django 폼툴즈 라이브러리의 폼 유저드 기능을
활용하여 여러 폼으로 단계를 나누어 입력을 받으시는 방법도 좋습니다.
User Creation Form 클래스는 유저 모델에 대한 모델 폼이고요.
메타 설정에 유저 네임 필드만 지정되어 있습니다.
유저 모델에 이메일 필드가 있으니 메타의 필드 설정에 이메일 필드 이름만 추가하는
것만으로도 회원가입 시에 이메일 입력을 추가로 지원할 수 있습니다.
크리스피 라이벌리 통해 폼 레이아웃을 구성하니까요.
레이아웃에도 이메일 필드를 추가하시면 회원가입 폼에서 이메일 주소를 추가로 받게 됩니다.
페이지 새로고침하시면 이메일 폼필드가 추가되어 있고요.
유저 모델의 이메일 필드는 옵션 필드이니 모델 폼에서도 이메일 필드는 옵션 필드로 처리되고
있습니다. 사인업 폼의 메타 필드 설정에서 유저 네임 설정은 유저 크리에이션 폼 설정을
덮어 썼는데요.
이를 덮어 쓰지 않고 유저 크리에이션 폼의 메타 필드 설정에 추가하는 방식으로 이렇게
구현하실 수도 있습니다.
필드 값이 튜플 타입이라서 제가 쓴 리스트와 연결 연산에서 오류가 발생했네요.
튜플로 변경해 줍니다.
이메일 폼필드를 필수 필드로 변경해 보겠습니다.
생성자를 재정의하시고요.
부모의 생성자를 호출하여 모든 폼필드가 생성되면 필드 멤버 변수로 생성된 모든 폼필드
인스턴스를 조회하실 수 있고요.
이메일 필드의 required 속성을 참으로 변경하여 필수 폼필드로 변경합니다.
페이지 새로고침하시면 이제 필수 폼필드로 처리되었음을 확인하실 수 있습니다.
유저 모델에서 이메일 필드는 이메일 필드 모델 필드만 사용했을 뿐 유니크 설정이 없습니다.
그러니 여러 유저가 같은 이메일 주소를 저장할 수도 있는데요.
회원가입 단계에서 대소문자를 가리지 않고 이메일 주소의 유일성을 체크하는 유효성 검사를
추가해 주겠습니다.