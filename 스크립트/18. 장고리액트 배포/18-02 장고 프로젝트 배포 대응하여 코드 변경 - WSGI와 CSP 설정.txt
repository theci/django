이번 영상에서는 장고 프로젝트 재배포 준비를 위해 코드를 변경해 보겠습니다.
본 스크립트 링크는 강의 노트를 통해 확인하실 수 있습니다.
먼저 배포 서버에서는 Next.js 페이지를 호출하진 않을 것이기에, Next.js 호출
코드를 제거하겠습니다.
마이 사이트의 urspy 파일에서 루트뷰를 통해 호출되고 있죠.
루트뷰를 제거하면 최상위 주소는 아래 포토로그 앱을 통해 처리될 것입니다.
그리고 장고 개발 환경에서 ASGI를 사용한 것은 Next.js 페이지에서 HMR 웹소켓
요청을 장고 서버에서 중개하기 위함이었습니다.
배포 서버에서는 이 기능이 필요 없으니 ASGI가 아닌 WSGI로 구동되도록 하겠습니다.
Installed Apps List에서 Daphne 앱과 Django Next.js 앱을
제거해 주세요 배포 서버에서 CRA 애플리케이션은 빌드에서 Nginx를 통해서 서빙할
것입니다 그러니 Django 서버와 CRA 애플리케이션은 동일 출처가 되는 거죠
CSP 설정에서 동일 출처 지원을 위해 Settings 설정을 추가하겠습니다
동일 출처에서는 CSP Frame Ancestors 환경 변수 설정을 하지 않을 것이고요
그럼 CSP Frame Ancestors 값은 빈 리스트가 되겠죠
다른 CSP 설정에서는 셀프 설정이 있으니 그대로 두시고요
CSP Frame Ancestors 설정에만 이 설정이 비었을 때 셀프 설정을 추가해
주겠습니다 소스 코드 저장하시고 배포 서버에도 배포해 주세요