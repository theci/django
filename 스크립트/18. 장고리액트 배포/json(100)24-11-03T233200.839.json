HTTP 여러분의 서버 IP 슬러시 CRA 주소를 열어보시면 이렇게 CRA 애플리케이션이
잘 뜨실 겁니다 배포된 장고 서비스에 로그인된 상황이시라면 이렇게 인증된 아이디가 뜨실
것이고요 장고 서버와 CRA 애플리케이션이 같은 출처이기 때문에 별도의 CORS 설정도
필요 없습니다 그냥 쿠키가 공유되고 그냥 세션 인증을 활용하시면 됩니다
페이지 이동도 잘 되고요.
내비게이션 메뉴를 통해 About 페이지로 이동하시면 이는 리액트 라우터가 흉내 낸
것이죠. 그리고 페이지 새로 고침하시면 이번에는 전체 페이지가 새로 그려지면서 엔진엑스에서
현재 페이지 주소의 링크를 보고 index.html 파일 응답을 준 것이고요.
그리고 React 라우터에서 현재 URL에 맞는 화면을 다시 그린 상황입니다.
엔진엑스 설정이 맞지 않으면 이 페이지 세로 열기에서 CRA 리액트 애플리케이션 페이지가 뜨지 않고
장고 딴에서 404 오류가 발생할 것입니다.
CRA 리액트 애플리케이션을 수정하고 수정 내역 반영을 위해 재배포를 해보겠습니다.
타이틀 하나를 고쳐보겠습니다.
그리고 npm run build 명령을 수행하고요.
그럼 빌드 폴더에 빌드 파일들이 생성되겠죠.
이제 npm run deploy 명령을 실행하시면 배포 끝입니다.
엔진엑스가 바라보고 있는 Current Symbolic Link는 방금 복사한 폴더를
바라보고 있을 겁니다.
페이지 새로 고침하시면 방금 수정한 화면을 확인하실 수 있습니다.
현재 방식으로 CRA 애플리케이션을 배포하다 보면 폴더가 계속 쌓이게 됩니다.
주로 최신 배포의 폴더를 사용하시게 될 것이고요
오래된 폴더들은 자동 삭제가 필요합니다
파인드 명령으로 루트의 srv, cra, build 경로 내에서 현재 디렉토리 제외하고
파일이 아닌 디렉토리만 대상으로 그리고 수정이 30일이 지난 그리고 이름은 current가
아니고 그리고 current가 가리키는 디렉토리도 아닌 디렉토리만 뽑아서 rm-rf
명령으로 삭제하는 명령입니다
이 명령을 매번 수동 실행하실 수도 있겠지만 자동 실행하시려면 리눅스에서는 크론 탭에
등록하시면 됩니다
크론 탭 "-e 옵션으로 크론 탭 편집하실 수 있고요 사용하실 에디터 선택해 주시고 시간
스케줄과 함께 명령을 등록해 주시면 매일 자정에 이 명령이 자동 수행되어 30일이 지난
디렉토리들은 자동 삭제됩니다